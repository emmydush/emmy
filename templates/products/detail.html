{% extends 'base.html' %}

{% load i18n static %}

{% block title %}Product Details - Inventory Management System{% endblock %}

{% block extra_css %}
<!-- Dashboard UI CSS for consistent styling -->
<link href="{% static 'css/dashboard-ui.css' %}" rel="stylesheet">
<style>
/* Product image continuous rotation effect with dynamic shadows */
.product-image-container {
    perspective: 1000px;
    margin: 0 auto;
    width: fit-content;
    position: relative;
}

.product-image-3d {
    width: 100%;
    height: auto;
    transform-style: preserve-3d;
    border-radius: 8px;
    box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
    display: block;
    animation: rotate3d 20s infinite linear;
    transition: box-shadow 0.3s ease;
}

@keyframes rotate3d {
    0% {
        transform: rotateY(0deg) rotateX(5deg);
        box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
    }
    25% {
        transform: rotateY(90deg) rotateX(-5deg);
        box-shadow: 0 4px 15px rgba(155, 89, 182, 0.3);
    }
    50% {
        transform: rotateY(180deg) rotateX(5deg);
        box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
    }
    75% {
        transform: rotateY(270deg) rotateX(-5deg);
        box-shadow: 0 4px 15px rgba(241, 196, 15, 0.3);
    }
    100% {
        transform: rotateY(360deg) rotateX(5deg);
        box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
    }
}

/* Add a glowing effect container */
.product-image-container::before {
    content: '';
    position: absolute;
    top: -15px;
    left: -15px;
    right: -15px;
    bottom: -15px;
    border-radius: 15px;
    background: linear-gradient(45deg, 
        rgba(52, 152, 219, 0.1),
        rgba(155, 89, 182, 0.1),
        rgba(231, 76, 60, 0.1),
        rgba(241, 196, 15, 0.1));
    z-index: -1;
    animation: glow 4s infinite linear;
    opacity: 0.5;
}

@keyframes glow {
    0% {
        background: linear-gradient(45deg, 
            rgba(52, 152, 219, 0.1),
            rgba(155, 89, 182, 0.1),
            rgba(231, 76, 60, 0.1),
            rgba(241, 196, 15, 0.1));
    }
    25% {
        background: linear-gradient(45deg, 
            rgba(155, 89, 182, 0.1),
            rgba(231, 76, 60, 0.1),
            rgba(241, 196, 15, 0.1),
            rgba(52, 152, 219, 0.1));
    }
    50% {
        background: linear-gradient(45deg, 
            rgba(231, 76, 60, 0.1),
            rgba(241, 196, 15, 0.1),
            rgba(52, 152, 219, 0.1),
            rgba(155, 89, 182, 0.1));
    }
    75% {
        background: linear-gradient(45deg, 
            rgba(241, 196, 15, 0.1),
            rgba(52, 152, 219, 0.1),
            rgba(155, 89, 182, 0.1),
            rgba(231, 76, 60, 0.1));
    }
    100% {
        background: linear-gradient(45deg, 
            rgba(52, 152, 219, 0.1),
            rgba(155, 89, 182, 0.1),
            rgba(231, 76, 60, 0.1),
            rgba(241, 196, 15, 0.1));
    }
}

/* Pause rotation and glow on hover for better viewing */
.product-image-container:hover .product-image-3d {
    animation-play-state: paused;
}

.product-image-container:hover::before {
    animation-play-state: paused;
}

/* Ensure cards match dashboard styling */
.card {
    background: rgba(16, 42, 67, 0.7);
    border-radius: 12px;
    box-shadow: 0 8px 32px rgba(2, 12, 27, 0.3);
    border: 1px solid rgba(45, 74, 124, 0.5);
    backdrop-filter: blur(10px);
}

.card-header {
    background: rgba(45, 74, 124, 0.3);
    border-bottom: 1px solid rgba(45, 74, 124, 0.5);
    font-weight: 600;
    color: #ffffff;
}

/* Fix text visibility issues */
.text-muted {
    color: #94a3b8 !important;
}

.no-image-text {
    color: #94a3b8;
}

/* Enhanced table styling for better visibility */
.table-borderless {
    color: #ffffff;
}

.table-borderless th {
    color: #cbd5e1;
    font-weight: 600;
}

.table-borderless td {
    color: #ffffff;
    font-weight: 500;
}

/* Striped table rows for better readability */
.table-striped > tbody > tr:nth-of-type(odd) > td {
    background-color: rgba(45, 74, 124, 0.2) !important;
}

.table-striped > tbody > tr:nth-of-type(even) > td {
    background-color: rgba(16, 42, 67, 0.3) !important;
}

/* Enhanced table styling for better visibility */
.table-borderless td strong {
    color: #ffffff;
    font-weight: 500;
}

.table-borderless td span.badge {
    color: #ffffff;
}

/* Ensure badge text is visible */
.table-borderless td span.badge.bg-success,
.table-borderless td span.badge.bg-danger {
    color: #ffffff !important;
    font-weight: 500;
}

/* Add text shadow for better contrast */
.table-borderless td.text-white {
    text-shadow: 0 0 2px rgba(0, 0, 0, 0.5);
}

/* Ensure all text is visible */
.text-white-important {
    color: #ffffff !important;
}
</style>
{% endblock %}

{% block content %}
<!-- Ensure page has consistent background with dashboard -->
<div class="main-content" style="background: transparent;">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="text-white">Product Details</h2>
        <div>
            <a href="{% url 'products:update' product.pk %}" class="btn btn-warning me-2">
                <i class="fas fa-edit"></i> Edit
            </a>
            <a href="{% url 'products:delete' product.pk %}" class="btn btn-danger">
                <i class="fas fa-trash"></i> Delete
            </a>
        </div>
    </div>

    <div class="row">
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0 text-white">Product Image</h5>
                </div>
                <div class="card-body text-center">
                    {% if product.image %}
                        <div class="product-image-container">
                            <img src="{{ product.image.url }}" alt="{{ product.name }}" class="img-fluid product-image-3d">
                        </div>
                    {% else %}
                        <div class="bg-dark p-5 rounded">
                            <i class="fas fa-box fa-3x text-muted"></i>
                            <p class="mt-2 no-image-text">No image available</p>
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Barcode Section -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0 text-white">Barcode</h5>
                </div>
                <div class="card-body text-center">
                    {% if product.barcode %}
                        <!-- Display barcode image if available -->
                        <div class="mb-3">
                            <img src="{{ MEDIA_URL }}barcodes/barcode_{{ product.pk }}.png" alt="Barcode for {{ product.name }}" class="img-fluid" style="max-height: 120px;">
                        </div>
                        <div class="mb-2">
                            <strong class="text-white">Barcode Number:</strong><br>
                            <code class="text-white">{{ product.barcode }}</code>
                        </div>
                        <div class="mb-2">
                            <strong class="text-white">Format:</strong><br>
                            <span class="badge bg-info">{{ product.get_barcode_format_display }}</span>
                        </div>
                        <div class="mt-3">
                            <a href="{{ MEDIA_URL }}barcodes/barcode_{{ product.pk }}.png" download="barcode_{{ product.sku }}.png" class="btn btn-sm btn-primary">
                                <i class="fas fa-download"></i> Download Barcode
                            </a>
                        </div>
                    {% else %}
                        <p class="text-muted">No barcode available for this product.</p>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0 text-white">Product Information</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <table class="table table-borderless table-striped">
                                <tr>
                                    <th class="text-white">Name:</th>
                                    <td class="text-white">{{ product.name }}</td>
                                </tr>
                                <tr>
                                    <th class="text-white">SKU:</th>
                                    <td class="text-white">{{ product.sku }}</td>
                                </tr>
                                <tr>
                                    <th class="text-white">Category:</th>
                                    <td class="text-white">{{ product.category.name }}</td>
                                </tr>
                                <tr>
                                    <th class="text-white">Unit:</th>
                                    <td class="text-white">{{ product.unit.name }} ({{ product.unit.symbol }})</td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <table class="table table-borderless table-striped">
                                <tr>
                                    <th class="text-white">Quantity:</th>
                                    <td class="text-white">{{ product.quantity }}</td>
                                </tr>
                                <tr>
                                    <th class="text-white">Cost Price:</th>
                                    <td class="text-white">{{ business_settings.currency_symbol }} {{ product.cost_price }}</td>
                                </tr>
                                <tr>
                                    <th class="text-white">Selling Price:</th>
                                    <td class="text-white">{{ business_settings.currency_symbol }} {{ product.selling_price }}</td>
                                </tr>
                                <tr>
                                    <th class="text-white">Profit Margin:</th>
                                    <td class="text-white">{{ product.profit_margin|floatformat:2 }}%</td>
                                </tr>
                                <tr>
                                    <th class="text-white">Profit Per Unit:</th>
                                    <td class="text-white">{{ business_settings.currency_symbol }} {{ product.profit_per_unit|floatformat:2 }}</td>
                                </tr>
                                <tr>
                                    <th class="text-white">Total Profit (Current Stock):</th>
                                    <td class="text-white">{{ business_settings.currency_symbol }} {{ product.total_profit|floatformat:2 }}</td>
                                </tr>
                                <tr>
                                    <th class="text-white">Expiry Date:</th>
                                    <td class="text-white">{{ product.expiry_date|default:"N/A" }}</td>
                                </tr>
                                <tr>
                                    <th class="text-white">Status:</th>
                                    <td class="text-white">
                                        {% if product.is_active %}
                                            <span class="badge bg-success">Active</span>
                                        {% else %}
                                            <span class="badge bg-danger">Inactive</span>
                                        {% endif %}
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    {% if product.description %}
                    <div class="mt-4">
                        <h5 class="text-white">Description</h5>
                        <p class="text-white">{{ product.description }}</p>
                    </div>
                    {% endif %}
                    
                    <!-- Variants Section -->
                    {% if product.has_variants %}
                    <div class="mt-4">
                        <h5 class="text-white">Variants</h5>
                        <p class="text-muted">This product has variants. <a href="{% url 'products:variant_list' product.pk %}" class="text-white">View all variants</a></p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}