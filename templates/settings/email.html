{% extends 'base.html' %}

{% load i18n static %}

{% load i18n static %}
{% block extra_css %}
<!-- Dashboard UI CSS for consistent styling -->
<link href="{% static 'css/dashboard-ui.css' %}" rel="stylesheet">
<style>
    /* Ensure page has consistent background with dashboard */
    .main-content {
        background: transparent;
    }
    
    /* Style tables to match dashboard table styling */
    .table-card {
        background: rgba(16, 42, 67, 0.7);
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(2, 12, 27, 0.3);
        border: 1px solid rgba(45, 74, 124, 0.5);
        padding: 1rem;
        margin-bottom: 1.5rem;
        backdrop-filter: blur(10px);
    }
    
    .table-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }
    
    .table-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: #ffffff;
        margin: 0;
    }
    
    /* Style the table to match dashboard styling */
    .table {
        color: #ffffff;
        background: rgba(16, 42, 67, 0.5);
        border-collapse: separate;
        border-spacing: 0;
    }
    
    .table thead th {
        background: rgba(45, 74, 124, 0.5);
        border-color: rgba(45, 74, 124, 0.5);
        color: #cbd5e1;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.8rem;
        letter-spacing: 0.5px;
        padding: 0.75rem;
    }
    
    .table tbody td {
        border-color: rgba(45, 74, 124, 0.2);
        color: #cbd5e1;
        vertical-align: middle;
        padding: 0.75rem;
        background: rgba(16, 42, 67, 0.3);
    }
    
    .table tbody tr:nth-child(even) td {
        background: rgba(16, 42, 67, 0.4);
    }
    
    .table tbody tr:nth-child(odd) td {
        background: rgba(16, 42, 67, 0.2);
    }
    
    .table-hover tbody tr:hover {
        background: rgba(45, 74, 124, 0.3);
    }
    
    .table-hover tbody tr:hover td {
        background: rgba(45, 74, 124, 0.3);
    }
    
    /* Style form controls to match dashboard */
    .form-control, .form-select {
        background: rgba(16, 42, 67, 0.5);
        border: 1px solid rgba(45, 74, 124, 0.5);
        color: #ffffff;
        border-radius: 8px;
        padding: 0.5rem;
        font-size: 0.9rem;
    }
    
    .form-control:focus, .form-select:focus {
        background: rgba(16, 42, 67, 0.7);
        border-color: #00d4ff;
        box-shadow: 0 0 0 0.2rem rgba(0, 212, 255, 0.25);
        color: #ffffff;
    }
    
    .input-group-text {
        background: rgba(45, 74, 124, 0.5);
        border: 1px solid rgba(45, 74, 124, 0.5);
        color: #94a3b8;
        padding: 0.5rem;
        font-size: 0.9rem;
    }
    
    .card {
        background: rgba(16, 42, 67, 0.5);
        border: 1px solid rgba(45, 74, 124, 0.5);
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(2, 12, 27, 0.3);
        backdrop-filter: blur(10px);
    }
    
    .card-header {
        background: rgba(45, 74, 124, 0.3);
        border-bottom: 1px solid rgba(45, 74, 124, 0.5);
        font-weight: 600;
        color: #ffffff;
    }
</style>
{% endblock %}


{% block title %}Email Settings - {{ business_settings.business_name }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <h2><i class="fas fa-envelope"></i> Email Settings</h2>
        <p class="text-muted">Configure email settings for notifications and alerts.</p>
    </div>
</div>

<div class="row">
    <div class="col-md-8 mx-auto">
        <div class="card">
            <div class="card-header">
                <h5>Email Configuration</h5>
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    
                    <div class="mb-3">
                        <label for="{{ form.email_backend.id_for_label }}" class="form-label">Email Backend</label>
                        {{ form.email_backend }}
                        {% if form.email_backend.help_text %}
                            <div class="form-text">{{ form.email_backend.help_text }}</div>
                        {% endif %}
                        {% if form.email_backend.errors %}
                            <div class="text-danger">{{ form.email_backend.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <div id="smtp-settings" class="smtp-settings">
                        <div class="mb-3">
                            <label for="{{ form.email_host.id_for_label }}" class="form-label">Email Host</label>
                            {{ form.email_host }}
                            {% if form.email_host.help_text %}
                                <div class="form-text">{{ form.email_host.help_text }}</div>
                            {% endif %}
                            {% if form.email_host.errors %}
                                <div class="text-danger">{{ form.email_host.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="{{ form.email_port.id_for_label }}" class="form-label">Port</label>
                                    {{ form.email_port }}
                                    {% if form.email_port.help_text %}
                                        <div class="form-text">{{ form.email_port.help_text }}</div>
                                    {% endif %}
                                    {% if form.email_port.errors %}
                                        <div class="text-danger">{{ form.email_port.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Security</label>
                                    <div>
                                        <div class="form-check form-check-inline">
                                            {{ form.email_use_tls }}
                                            <label class="form-check-label" for="{{ form.email_use_tls.id_for_label }}">
                                                Use TLS
                                            </label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                            {{ form.email_use_ssl }}
                                            <label class="form-check-label" for="{{ form.email_use_ssl.id_for_label }}">
                                                Use SSL
                                            </label>
                                        </div>
                                    </div>
                                    {% if form.email_use_tls.errors or form.email_use_ssl.errors %}
                                        <div class="text-danger">
                                            {{ form.email_use_tls.errors }}
                                            {{ form.email_use_ssl.errors }}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="{{ form.email_host_user.id_for_label }}" class="form-label">Email Host User</label>
                            {{ form.email_host_user }}
                            {% if form.email_host_user.help_text %}
                                <div class="form-text">{{ form.email_host_user.help_text }}</div>
                            {% endif %}
                            {% if form.email_host_user.errors %}
                                <div class="text-danger">{{ form.email_host_user.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            <label for="{{ form.email_host_password.id_for_label }}" class="form-label">Email Host Password</label>
                            {{ form.email_host_password }}
                            {% if form.email_host_password.help_text %}
                                <div class="form-text">{{ form.email_host_password.help_text }}</div>
                            {% endif %}
                            {% if form.email_host_password.errors %}
                                <div class="text-danger">{{ form.email_host_password.errors }}</div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="{{ form.default_from_email.id_for_label }}" class="form-label">Default From Email</label>
                        {{ form.default_from_email }}
                        {% if form.default_from_email.help_text %}
                            <div class="form-text">{{ form.default_from_email.help_text }}</div>
                        {% endif %}
                        {% if form.default_from_email.errors %}
                            <div class="text-danger">{{ form.default_from_email.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="alert alert-info">
                        <h6><i class="fas fa-info-circle"></i> Email Configuration Tips</h6>
                        <ul class="mb-0">
                            <li>For Gmail: Use smtp.gmail.com with port 587 and TLS enabled. You'll need to generate an <a href="https://myaccount.google.com/apppasswords" target="_blank">App Password</a>.</li>
                            <li>For SendGrid: Use smtp.sendgrid.net with port 587 and TLS enabled.</li>
                            <li>For Amazon SES: Select the Amazon SES backend and configure AWS credentials.</li>
                            <li>For development: Use the Console backend to print emails to the terminal.</li>
                        </ul>
                    </div>
                    
                    <div class="d-flex justify-content-between">
                        <a href="{% url 'settings:index' %}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Back to Settings
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Save Email Settings
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const emailBackendSelect = document.getElementById('{{ form.email_backend.id_for_label }}');
    const smtpSettings = document.getElementById('smtp-settings');
    
    function toggleSMTPSettings() {
        if (emailBackendSelect.value === 'django.core.mail.backends.smtp.EmailBackend') {
            smtpSettings.style.display = 'block';
        } else {
            smtpSettings.style.display = 'none';
        }
    }
    
    // Initial check
    toggleSMTPSettings();
    
    // Listen for changes
    emailBackendSelect.addEventListener('change', toggleSMTPSettings);
});
</script>
{% endblock %}