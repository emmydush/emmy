{% extends 'superadmin/base.html' %}

{% block title %}Email Settings - Super Admin{% endblock %}

{% block superadmin_content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h1>Email Settings</h1>
</div>

<div class="row">
  <div class="col-md-8 mx-auto">
    <div class="card">
      <div class="card-header">
        <h5>Email Configuration</h5>
      </div>
      <div class="card-body">
        <form method="post">
          {% csrf_token %}
          
          <div class="mb-3">
            <label for="{{ form.email_backend.id_for_label }}" class="form-label">Email Backend</label>
            {{ form.email_backend }}
            {% if form.email_backend.help_text %}
              <div class="form-text">{{ form.email_backend.help_text }}</div>
            {% endif %}
            {% if form.email_backend.errors %}
              <div class="text-danger">{{ form.email_backend.errors }}</div>
            {% endif %}
          </div>
          
          <div id="smtp-settings" class="smtp-settings">
            <div class="mb-3">
              <label for="{{ form.email_host.id_for_label }}" class="form-label">Email Host</label>
              {{ form.email_host }}
              {% if form.email_host.help_text %}
                <div class="form-text">{{ form.email_host.help_text }}</div>
              {% endif %}
              {% if form.email_host.errors %}
                <div class="text-danger">{{ form.email_host.errors }}</div>
              {% endif %}
            </div>
            
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="{{ form.email_port.id_for_label }}" class="form-label">Port</label>
                  {{ form.email_port }}
                  {% if form.email_port.help_text %}
                    <div class="form-text">{{ form.email_port.help_text }}</div>
                  {% endif %}
                  {% if form.email_port.errors %}
                    <div class="text-danger">{{ form.email_port.errors }}</div>
                  {% endif %}
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label">Security</label>
                  <div>
                    <div class="form-check form-check-inline">
                      {{ form.email_use_tls }}
                      <label class="form-check-label" for="{{ form.email_use_tls.id_for_label }}">
                        Use TLS
                      </label>
                    </div>
                    <div class="form-check form-check-inline">
                      {{ form.email_use_ssl }}
                      <label class="form-check-label" for="{{ form.email_use_ssl.id_for_label }}">
                        Use SSL
                      </label>
                    </div>
                  </div>
                  {% if form.email_use_tls.errors or form.email_use_ssl.errors %}
                    <div class="text-danger">
                      {{ form.email_use_tls.errors }}
                      {{ form.email_use_ssl.errors }}
                    </div>
                  {% endif %}
                </div>
              </div>
            </div>
            
            <div class="mb-3">
              <label for="{{ form.email_host_user.id_for_label }}" class="form-label">Email Host User</label>
              {{ form.email_host_user }}
              {% if form.email_host_user.help_text %}
                <div class="form-text">{{ form.email_host_user.help_text }}</div>
              {% endif %}
              {% if form.email_host_user.errors %}
                <div class="text-danger">{{ form.email_host_user.errors }}</div>
              {% endif %}
            </div>
            
            <div class="mb-3">
              <label for="{{ form.email_host_password.id_for_label }}" class="form-label">Email Host Password</label>
              {{ form.email_host_password }}
              {% if form.email_host_password.help_text %}
                <div class="form-text">{{ form.email_host_password.help_text }}</div>
              {% endif %}
              {% if form.email_host_password.errors %}
                <div class="text-danger">{{ form.email_host_password.errors }}</div>
              {% endif %}
            </div>
          </div>
          
          <div class="mb-3">
            <label for="{{ form.default_from_email.id_for_label }}" class="form-label">Default From Email</label>
            {{ form.default_from_email }}
            {% if form.default_from_email.help_text %}
              <div class="form-text">{{ form.default_from_email.help_text }}</div>
            {% endif %}
            {% if form.default_from_email.errors %}
              <div class="text-danger">{{ form.default_from_email.errors }}</div>
            {% endif %}
          </div>
          
          <div class="alert alert-info">
            <h6><i class="fas fa-info-circle"></i> Email Configuration Tips</h6>
            <ul class="mb-0">
              <li>For Gmail: Use smtp.gmail.com with port 587 and TLS enabled. You'll need to generate an <a href="https://myaccount.google.com/apppasswords" target="_blank">App Password</a>.</li>
              <li>For SendGrid: Use smtp.sendgrid.net with port 587 and TLS enabled.</li>
              <li>For Amazon SES: Select the Amazon SES backend and configure AWS credentials.</li>
              <li>For development: Use the Console backend to print emails to the terminal.</li>
            </ul>
          </div>
          
          <div class="d-flex justify-content-between">
            <a href="{% url 'superadmin:dashboard' %}" class="btn btn-secondary">
              <i class="fas fa-arrow-left"></i> Back to Dashboard
            </a>
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-save"></i> Save Email Settings
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const emailBackendSelect = document.getElementById('{{ form.email_backend.id_for_label }}');
  const smtpSettings = document.getElementById('smtp-settings');
  
  function toggleSMTPSettings() {
    if (emailBackendSelect.value === 'django.core.mail.backends.smtp.EmailBackend') {
      smtpSettings.style.display = 'block';
    } else {
      smtpSettings.style.display = 'none';
    }
  }
  
  // Initial check
  toggleSMTPSettings();
  
  // Listen for changes
  emailBackendSelect.addEventListener('change', toggleSMTPSettings);
});
</script>
{% endblock %}