{% extends 'superadmin/base.html' %}

{% load static %}
{% block title %}System Dashboard - Super Admin - Smart Solution{% endblock %}

{% block extra_css %}
<!-- Dashboard UI CSS -->
<link href="{% static 'css/dashboard-ui.css' %}" rel="stylesheet">
{% endblock %}

{% block superadmin_content %}
<div class="dashboard-container">
    <div class="dashboard-header">
        <h1><i class="fas fa-chart-network me-2"></i>System Overview</h1>
        <p class="text-muted">Real-time monitoring of all system components</p>
    </div>

    <!-- System Stats Cards -->
    <div class="stats-grid">
        <div class="stat-card highlight-blue">
            <div class="stat-icon blue-glow">
                <i class="fas fa-building fa-2x"></i>
            </div>
            <div class="stat-number text-primary">{{ total_businesses }}</div>
            <div class="stat-title">Total Businesses</div>
            <div class="stat-progress">
                <div class="stat-progress-bar" data-width="{% if total_businesses > 0 %}{% widthratio active_businesses total_businesses 100 %}{% else %}0{% endif %}"></div>
            </div>
        </div>

        <div class="stat-card highlight-orange">
            <div class="stat-icon orange-glow">
                <i class="fas fa-users fa-2x"></i>
            </div>
            <div class="stat-number text-success">{{ total_users }}</div>
            <div class="stat-title">Total Users</div>
            <div class="stat-progress">
                <div class="stat-progress-bar orange" data-width="{% if total_users > 0 %}{% widthratio active_businesses total_businesses 100 %}{% else %}0{% endif %}"></div>
            </div>
        </div>

        <div class="stat-card highlight-blue">
            <div class="stat-icon blue-glow">
                <i class="fas fa-shopping-cart fa-2x"></i>
            </div>
            <div class="stat-number text-info">{{ total_transactions }}</div>
            <div class="stat-title">Total Transactions</div>
            <div class="stat-progress">
                <div class="stat-progress-bar" data-width="{% if total_transactions > 0 %}{% widthratio todays_transactions total_transactions 100 %}{% else %}0{% endif %}"></div>
            </div>
        </div>

        <div class="stat-card highlight-orange">
            <div class="stat-icon orange-glow">
                <i class="fas fa-boxes fa-2x"></i>
            </div>
            <div class="stat-number text-warning">{{ total_stock_items }}</div>
            <div class="stat-title">Total Stock Items</div>
            <div class="stat-progress">
                <div class="stat-progress-bar orange" data-width="99.9"></div>
            </div>
        </div>
    </div>

    <!-- Enhanced Analytics Row -->
    <div class="stats-grid">
        <div class="stat-card highlight-orange">
            <div class="stat-icon orange-glow">
                <i class="fas fa-credit-card fa-2x"></i>
            </div>
            <div class="stat-number text-danger">{{ active_subscriptions }}</div>
            <div class="stat-title">Active Subscriptions</div>
            <div class="stat-progress">
                <div class="stat-progress-bar orange" data-width="{% if total_subscriptions > 0 %}{% widthratio active_subscriptions total_subscriptions 100 %}{% else %}0{% endif %}"></div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-shield-alt fa-2x"></i>
            </div>
            <div class="stat-number text-secondary">{{ security_events }}</div>
            <div class="stat-title">Security Alerts</div>
            <div class="stat-progress">
                <div class="stat-progress-bar" data-width="{% if total_logs > 0 %}{% widthratio security_events total_logs 100 %}{% else %}0{% endif %}"></div>
            </div>
        </div>

        <div class="stat-card highlight-blue">
            <div class="stat-icon blue-glow">
                <i class="fas fa-code fa-2x"></i>
            </div>
            <div class="stat-number text-success">{{ api_clients }}</div>
            <div class="stat-title">API Clients</div>
            <div class="stat-progress">
                <div class="stat-progress-bar" data-width="{% if api_clients > 0 %}{% widthratio active_api_clients api_clients 100 %}{% else %}0{% endif %}"></div>
            </div>
        </div>

        <div class="stat-card highlight-blue">
            <div class="stat-icon blue-glow">
                <i class="fas fa-file-alt fa-2x"></i>
            </div>
            <div class="stat-number text-info">{{ total_logs }}</div>
            <div class="stat-title">System Logs</div>
            <div class="stat-progress">
                <div class="stat-progress-bar" data-width="0.5"></div>
            </div>
        </div>
    </div>

    <!-- System Health and Activity -->
    <div class="charts-row">
        <div class="chart-card">
            <div class="chart-header">
                <h3 class="chart-title"><i class="fas fa-heartbeat me-2 text-danger"></i>System Performance</h3>
                <div class="chart-controls">
                    <button class="btn btn-sm btn-outline-secondary chart-refresh" data-chart="performanceChart">
                        <i class="fas fa-sync"></i>
                    </button>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="performanceChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3 class="chart-title"><i class="fas fa-bell me-2 text-warning"></i>Recent Alerts</h3>
            </div>
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>Message</th>
                            <th>Time</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for event in recent_security_events %}
                        <tr>
                            <td>
                                <span class="badge bg-{% if event.is_resolved %}success{% else %}danger{% endif %}">
                                    {{ event.event_type|title }}
                                </span>
                            </td>
                            <td>{{ event.description|truncatewords:5 }}</td>
                            <td>{{ event.timestamp|date:"H:i" }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="3" class="text-center">No recent alerts</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Pending Actions -->
    <div class="table-card">
        <div class="table-header">
            <h3 class="table-title"><i class="fas fa-tasks me-2 text-info"></i>Pending Actions</h3>
            <button class="btn btn-outline-primary">
                <i class="fas fa-plus me-2"></i>Create Task
            </button>
        </div>
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Task</th>
                        <th>Priority</th>
                        <th>Assigned To</th>
                        <th>Due Date</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Review new business registration</td>
                        <td><span class="badge bg-danger">High</span></td>
                        <td>System Admin</td>
                        <td>Today</td>
                        <td><span class="badge bg-warning">Pending</span></td>
                    </tr>
                    <tr>
                        <td>Update SSL certificates</td>
                        <td><span class="badge bg-warning">Medium</span></td>
                        <td>Security Team</td>
                        <td>Tomorrow</td>
                        <td><span class="badge bg-info">In Progress</span></td>
                    </tr>
                    <tr>
                        <td>Database backup verification</td>
                        <td><span class="badge bg-success">Low</span></td>
                        <td>DevOps Team</td>
                        <td>Dec 10, 2025</td>
                        <td><span class="badge bg-success">Completed</span></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Initialize progress bars
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.stat-progress-bar').forEach(bar => {
            const width = bar.getAttribute('data-width') || 0;
            bar.style.width = Math.min(width, 100) + '%';
        });
    });

    // Performance Chart
    document.addEventListener('DOMContentLoaded', function() {
        const ctx = document.getElementById('performanceChart').getContext('2d');
        const performanceChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00', '24:00'],
                datasets: [{
                    label: 'CPU Usage %',
                    data: [20, 25, 30, 28, 35, 40, 32],
                    borderColor: 'rgba(0, 212, 255, 1)',
                    backgroundColor: 'rgba(0, 212, 255, 0.2)',
                    tension: 0.4,
                    fill: true
                }, {
                    label: 'Memory Usage %',
                    data: [45, 50, 55, 60, 65, 70, 68],
                    borderColor: 'rgba(255, 126, 0, 1)',
                    backgroundColor: 'rgba(255, 126, 0, 0.2)',
                    tension: 0.4,
                    fill: true
                }, {
                    label: 'Network I/O',
                    data: [15, 20, 25, 30, 35, 40, 38],
                    borderColor: 'rgba(0, 255, 255, 1)',
                    backgroundColor: 'rgba(0, 255, 255, 0.2)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: '#ffffff'
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            color: '#cbd5e1'
                        }
                    },
                    x: {
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            color: '#cbd5e1'
                        }
                    }
                }
            }
        });

        // Chart refresh functionality
        document.querySelectorAll('.chart-refresh').forEach(button => {
            button.addEventListener('click', function() {
                const chartId = this.getAttribute('data-chart');
                // Add refresh animation
                this.classList.add('spin');
                setTimeout(() => {
                    this.classList.remove('spin');
                }, 1000);
                
                // In a real implementation, you would refresh the chart data here
                console.log(`Refreshing chart: ${chartId}`);
            });
        });
    });
</script>
{% endblock %}